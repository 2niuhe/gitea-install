# Gitea å®‰è£…ä¸æ•°æ®è¿ç§»å®Œæ•´æ€»ç»“

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æˆåŠŸéƒ¨ç½²äº† Gitea Git æœåŠ¡ï¼Œæä¾›äº†å®Œæ•´çš„å®‰è£…ã€ç®¡ç†å’Œæ•°æ®è¿ç§»è§£å†³æ–¹æ¡ˆã€‚

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ ¸å¿ƒæœåŠ¡éƒ¨ç½²
- âœ… Gitea æœåŠ¡å·²æˆåŠŸå¯åŠ¨å¹¶è¿è¡Œ
- âœ… Web æœåŠ¡: http://localhost:4000
- âœ… SSH æœåŠ¡: git@localhost:222
- âœ… ä½¿ç”¨ Docker å·è¿›è¡Œæ•°æ®æŒä¹…åŒ–

### 2. åˆ›å»ºçš„é…ç½®æ–‡ä»¶

| æ–‡ä»¶å | ç”¨é€” | çŠ¶æ€ |
|--------|------|------|
| `docker-compose-gitea.yml` | Gitea æœåŠ¡é…ç½® | âœ… å·²éƒ¨ç½² |
| `Giteaä½¿ç”¨æŒ‡å—.md` | ç”¨æˆ·ä½¿ç”¨æ‰‹å†Œ | âœ… å®Œæˆ |
| `manage-gitea.sh` | æœåŠ¡ç®¡ç†è„šæœ¬ | âœ… å¯æ‰§è¡Œ |
| `migrate-gitea.sh` | æ•°æ®è¿ç§»è„šæœ¬ | âœ… å¯æ‰§è¡Œ |
| `Giteaå®Œæ•´å®‰è£…ä¸è¿ç§»æŒ‡å—.md` | è¯¦ç»†æŠ€æœ¯æ–‡æ¡£ | âœ… å®Œæˆ |
| `å­˜å‚¨æŒ‚è½½è¯¦è§£.md` | å­˜å‚¨æŠ€æœ¯è¯´æ˜ | âœ… å®Œæˆ |

### 3. æœåŠ¡å½“å‰çŠ¶æ€

```bash
# æœåŠ¡çŠ¶æ€
Name: gitea
State: Up
Ports:
  - 4000:4000 (Web)
  - 222:22 (SSH)

# æ•°æ®å·
Volume: gitea_data
Driver: local
Location: /var/lib/docker/volumes/gitea_data/_data
```

## ğŸ“ å­˜å‚¨æŒ‚è½½æ¶æ„

### å½“å‰é…ç½®ï¼šDocker å·æŒ‚è½½
```yaml
volumes:
  - gitea_data:/data
```

### æ•°æ®ç»“æ„
```
/data/
â”œâ”€â”€ git/repositories/     # Git ä»“åº“
â”œâ”€â”€ gitea/                # åº”ç”¨æ•°æ®
â”‚   â”œâ”€â”€ conf/app.ini     # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ gitea.db         # SQLite æ•°æ®åº“
â”‚   â”œâ”€â”€ log/             # æ—¥å¿—æ–‡ä»¶
â”‚   â””â”€â”€ sessions/        # ä¼šè¯æ–‡ä»¶
â””â”€â”€ ssh/                 # SSH å¯†é’¥
```

### å­˜å‚¨å®¹é‡
- **å½“å‰å ç”¨**: çº¦ 100MB
- **æ¨èå®¹é‡**: 10GB+ (æ ¹æ®ä»“åº“æ•°é‡å¢é•¿)

## ğŸ”„ æ•°æ®è¿ç§»æ–¹æ¡ˆ

### åœºæ™¯ï¼šä»æœºå™¨Aè¿ç§»åˆ°æœºå™¨B

#### æ–¹æ¡ˆ1ï¼šè‡ªåŠ¨åŒ–è¿ç§»è„šæœ¬ (æ¨è)
```bash
# åœ¨æœºå™¨Bæ‰§è¡Œ
./migrate-gitea.sh export user@machineA
./migrate-gitea.sh import
```

#### æ–¹æ¡ˆ2ï¼šæ‰‹åŠ¨è¿ç§»æ­¥éª¤

**æ­¥éª¤1: åœ¨æœºå™¨Aå¯¼å‡º**
```bash
# 1. åœæ­¢æœåŠ¡
docker-compose down

# 2. å¯¼å‡ºæ•°æ®å·
docker run --rm \
  -v gitea_gitea_data:/data \
  -v $(pwd):/backup \
  alpine tar czf /backup/gitea_backup.tar.gz -C /data .

# 3. ä¼ è¾“å¤‡ä»½æ–‡ä»¶
scp gitea_backup.tar.gz user@machineB:/path/to/
```

**æ­¥éª¤2: åœ¨æœºå™¨Bå¯¼å…¥**
```bash
# 1. åˆ›å»ºç›¸åŒç›®å½•ç»“æ„
mkdir -p ~/gitea-docker
cd ~/gitea-docker

# 2. å¯åŠ¨æœåŠ¡åˆ›å»ºå·
docker-compose up -d && docker-compose down

# 3. å¯¼å…¥æ•°æ®
docker run --rm \
  -v gitea_gitea_data:/data \
  -v $(pwd):/backup \
  alpine tar xzf /backup/gitea_backup.tar.gz -C /data

# 4. ä¿®å¤æƒé™å¹¶å¯åŠ¨
docker run --rm -v gitea_gitea_data:/data alpine chown -R 1000:1000 /data
docker-compose up -d
```

## ğŸ› ï¸ ç®¡ç†å‘½ä»¤

### æœåŠ¡ç®¡ç†
```bash
# å¯åŠ¨æœåŠ¡
./manage-gitea.sh start

# åœæ­¢æœåŠ¡
./manage-gitea.sh stop

# æŸ¥çœ‹çŠ¶æ€
./manage-gitea.sh status

# æŸ¥çœ‹æ—¥å¿—
./manage-gitea.sh logs

# æ›´æ–°æœåŠ¡
./manage-gitea.sh update

# å¤‡ä»½æ•°æ®
./manage-gitea.sh backup
```

### è¿ç§»æ“ä½œ
```bash
# æ•°æ®å¯¼å‡º
./migrate-gitea.sh export user@source-server

# æ•°æ®å¯¼å…¥
./migrate-gitea.sh import

# æœ¬åœ°å¤‡ä»½
./migrate-gitea.sh backup

# ä»å¤‡ä»½æ¢å¤
./migrate-gitea.sh restore backup_file.tar.gz

# æ•°æ®éªŒè¯
./migrate-gitea.sh verify
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. æœåŠ¡æ— æ³•å¯åŠ¨
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep :4000

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose logs gitea

# æ£€æŸ¥é…ç½®æ–‡ä»¶
docker exec gitea cat /data/gitea/conf/app.ini
```

#### 2. æƒé™é—®é¢˜
```bash
# ä¿®å¤æ•°æ®å·æƒé™
docker run --rm \
  -v gitea_gitea_data:/data \
  alpine chown -R 1000:1000 /data
```

#### 3. æ•°æ®åº“é—®é¢˜
```bash
# æ£€æŸ¥æ•°æ®åº“å®Œæ•´æ€§
docker exec gitea sqlite3 /data/gitea/gitea.db "PRAGMA integrity_check;"

# é‡ç½®ç®¡ç†å‘˜å¯†ç 
docker exec gitea gitea admin user change-password --username admin --password newpass
```

#### 4. è¿ç§»å¤±è´¥
```bash
# éªŒè¯å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§
tar -tzf gitea_backup.tar.gz

# æ£€æŸ¥æ•°æ®å·çŠ¶æ€
docker volume ls | grep gitea

# æ‰‹åŠ¨éªŒè¯æ•°æ®
docker run --rm -v gitea_gitea_data:/data alpine ls -la /data
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å­˜å‚¨ä¼˜åŒ–
- **ä½¿ç”¨ SSD** æé«˜è¯»å†™æ€§èƒ½
- **å®šæœŸæ¸…ç†** Docker ç³»ç»Ÿèµ„æº
- **ç›‘æ§ç£ç›˜ä½¿ç”¨** é¿å…ç©ºé—´ä¸è¶³

### 2. æœåŠ¡ä¼˜åŒ–
- **é…ç½®ç¼“å­˜** æé«˜å“åº”é€Ÿåº¦
- **æ—¥å¿—è½®è½¬** é˜²æ­¢æ—¥å¿—è¿‡å¤§
- **å¯ç”¨å‹ç¼©** å‡å°‘å­˜å‚¨å ç”¨

### 3. ç½‘ç»œä¼˜åŒ–
- **é…ç½® HTTPS** æé«˜å®‰å…¨æ€§
- **ä½¿ç”¨ CDN** åŠ é€Ÿé™æ€èµ„æº
- **ä¼˜åŒ– SSH** è¿æ¥é…ç½®

## ğŸ”’ å®‰å…¨å»ºè®®

### 1. è®¿é—®æ§åˆ¶
- æ›´æ”¹é»˜è®¤ç®¡ç†å‘˜å¯†ç 
- é…ç½®é˜²ç«å¢™è§„åˆ™
- å¯ç”¨åŒå› ç´ è®¤è¯

### 2. æ•°æ®ä¿æŠ¤
- å®šæœŸå¤‡ä»½æ•°æ®
- åŠ å¯†æ•æ„Ÿä¿¡æ¯
- é™åˆ¶æ–‡ä»¶æƒé™

### 3. ç³»ç»Ÿå®‰å…¨
- åŠæ—¶æ›´æ–°ç³»ç»Ÿè¡¥ä¸
- ç›‘æ§å¼‚å¸¸è®¿é—®
- é…ç½®å…¥ä¾µæ£€æµ‹

## ğŸ“ˆ æ‰©å±•æ–¹æ¡ˆ

### 1. é«˜å¯ç”¨éƒ¨ç½²
- **è´Ÿè½½å‡è¡¡**: Nginx + å¤šä¸ª Gitea å®ä¾‹
- **æ•°æ®åº“é›†ç¾¤**: PostgreSQL ä¸»ä»å¤åˆ¶
- **å­˜å‚¨æ–¹æ¡ˆ**: NFS / åˆ†å¸ƒå¼å­˜å‚¨

### 2. ç›‘æ§å‘Šè­¦
- **æœåŠ¡ç›‘æ§**: Prometheus + Grafana
- **æ—¥å¿—åˆ†æ**: ELK Stack
- **å‘Šè­¦é€šçŸ¥**: é‚®ä»¶ / å¾®ä¿¡ / é’‰é’‰

### 3. è‡ªåŠ¨åŒ–è¿ç»´
- **CI/CD é›†æˆ**: Jenkins / GitLab CI
- **è‡ªåŠ¨åŒ–éƒ¨ç½²**: Ansible / Docker Swarm
- **é…ç½®ç®¡ç†**: GitOps / Kubernetes

## ğŸ“ ä½¿ç”¨æµç¨‹

### é¦–æ¬¡ä½¿ç”¨
1. **è®¿é—®**: http://localhost:4000
2. **åˆå§‹åŒ–**: åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·
3. **é…ç½®**: è®¾ç½®æœåŠ¡å™¨å‚æ•°
4. **ä½¿ç”¨**: åˆ›å»ºç¬¬ä¸€ä¸ªä»“åº“

### æ—¥å¸¸ç»´æŠ¤
1. **ç›‘æ§**: å®šæœŸæ£€æŸ¥æœåŠ¡çŠ¶æ€
2. **å¤‡ä»½**: æ¯æ—¥è‡ªåŠ¨å¤‡ä»½æ•°æ®
3. **æ›´æ–°**: è·Ÿè¿›ç‰ˆæœ¬æ›´æ–°
4. **æ¸…ç†**: å®šæœŸæ¸…ç†æ— ç”¨æ•°æ®

### æ•°æ®è¿ç§»
1. **å‡†å¤‡**: ç¡®è®¤ç›®æ ‡ç¯å¢ƒå°±ç»ª
2. **å¤‡ä»½**: åˆ›å»ºå®Œæ•´æ•°æ®å¤‡ä»½
3. **è¿ç§»**: ä½¿ç”¨è¿ç§»è„šæœ¬æˆ–æ‰‹åŠ¨æ“ä½œ
4. **éªŒè¯**: ç¡®è®¤æ•°æ®å®Œæ•´æ€§

## ğŸ‰ é¡¹ç›®æ€»ç»“

é€šè¿‡æœ¬é¡¹ç›®ï¼Œæ‚¨å·²ç»è·å¾—äº†ï¼š

1. âœ… **å®Œæ•´çš„ Git æœåŠ¡**: åŠŸèƒ½å®Œæ•´çš„ç§æœ‰ Git ä»“åº“
2. âœ… **è¯¦ç»†çš„æ–‡æ¡£**: ä»å®‰è£…åˆ°ç»´æŠ¤çš„å…¨å¥—æŒ‡å—
3. âœ… **è‡ªåŠ¨åŒ–å·¥å…·**: ç®¡ç†è„šæœ¬å’Œè¿ç§»å·¥å…·
4. âœ… **æœ€ä½³å®è·µ**: å®‰å…¨ã€æ€§èƒ½ã€å¤‡ä»½å»ºè®®

### å…³é”®ä¼˜åŠ¿
- **è½»é‡çº§**: ç›¸æ¯” GitLab èµ„æºå ç”¨æå°‘
- **æ˜“éƒ¨ç½²**: ä¸€ä¸ªå‘½ä»¤å³å¯å®Œæˆå®‰è£…
- **æ˜“ç»´æŠ¤**: æä¾›å®Œæ•´çš„ç®¡ç†å·¥å…·
- **æ˜“è¿ç§»**: å®Œæ•´çš„æ•°æ®è¿ç§»æ–¹æ¡ˆ
- **é«˜å¯é **: æ•°æ®æŒä¹…åŒ–å’Œå¤‡ä»½æœºåˆ¶

### åç»­å»ºè®®
1. **å®šæœŸå¤‡ä»½**: å»ºç«‹è‡ªåŠ¨åŒ–å¤‡ä»½ç­–ç•¥
2. **ç›‘æ§å‘Šè­¦**: é…ç½®æœåŠ¡ç›‘æ§
3. **å®‰å…¨åŠ å›º**: å®æ–½å®‰å…¨æœ€ä½³å®è·µ
4. **æ€§èƒ½ä¼˜åŒ–**: æ ¹æ®ä½¿ç”¨æƒ…å†µè°ƒä¼˜
5. **æ–‡æ¡£æ›´æ–°**: ä¿æŒé…ç½®æ–‡æ¡£åŒæ­¥

---

**æ­å–œï¼** æ‚¨ç°åœ¨æ‹¥æœ‰äº†ä¸€ä¸ªç¨³å®šã€å¯é çš„ç§æœ‰ Git æœåŠ¡å¹³å°ï¼ğŸš€